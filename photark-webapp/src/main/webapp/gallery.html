<!--
    * Licensed to the Apache Software Foundation (ASF) under one
    * or more contributor license agreements.  See the NOTICE file
    * distributed with this work for additional information
    * regarding copyright ownership.  The ASF licenses this file
    * to you under the Apache License, Version 2.0 (the
    * "License"); you may not use this file except in compliance
    * with the License.  You may obtain a copy of the License at
    *
    *   http://www.apache.org/licenses/LICENSE-2.0
    *
    * Unless required by applicable law or agreed to in writing,
    * software distributed under the License is distributed on an
    * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    * KIND, either express or implied.  See the License for the
    * specific language governing permissions and limitations
    * under the License.
-->
<html>
<head>
<title>Photo Gallery</title>

<link href="styles.css" rel="stylesheet">

<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/dojo/1.4/dojo/dojo.xd.js">
	
</script>

<script language="JavaScript">

    index_off= new Image(31,31); index_off.src = "index.gif";
    index_on = new Image(31,31); index_on.src = "index_on.gif";
    next_off = new Image(31,31); next_off.src = "next.gif";
    next_on  = new Image(31,31); next_on.src = "next_on.gif";
    prev_off = new Image(31,31); prev_off.src = "prev.gif";
    prev_on  = new Image(31,31); prev_on.src = "prev_on.gif";

    var gallery;
     
	var galleryName;
	var galleryAlbums;
	var albumCovers = new Array();
	var albumName;
	var albumItems;
	var albumPos = 0;

	var pos = 0;

	
	dojo.addOnLoad(function(){ 
		dojo.require("dojo.rpc.JsonService");
	    dojo.addOnLoad(initServices);
	    dojo.addOnLoad(initGallery);
	 });

	 
	function initServices(){
		gallery = new dojo.rpc.JsonService("/photark/Gallery?smd");
	}

	
	function initGallery(){
		try{
			gallery.getAlbums().addCallback(gallery_getAlbumsResponse);
		 } 
		catch(exception){
			alert(e);
		}
	}
	
	function gallery_getAlbumsResponse(albums, exception) {
		if(exception) {
			alert(exception.msg);
			return;
		}
		
		galleryAlbums = albums;
		
		for(i=0; i< galleryAlbums.length; i++)
		{
			gallery.getAlbumCover(galleryAlbums[i].name).addCallback(gallery_getAlbumCoverResponse);
		}
	}

	function gallery_getAlbumCoverResponse(cover, exception)
	{
		albumCovers[pos] = cover;
		pos += 1;
		if(albumCovers.length == galleryAlbums.length) 
		{
			initializeGallery();
			displayGallery();
		}
	}

	function initializeGallery() {
		var table=document.getElementById('tableGallery');
		var lastRow = table.rows.length;
		for(i=0; i<galleryAlbums.length; i++) {
			   var row=table.insertRow(lastRow++);
			   var column=row.insertCell(0);
			   var albumName = galleryAlbums[i].name;
			   var img = document.createElement("img");
			   img.src = "gallery/" + albumName + "/" + albumCovers[i];
			   var img_html = "<img src=" + img.src + " class=\"slideImage\" height=25% width=25% ondragstart=\"return false\" onselectstart=\"return false\" oncontextmenu=\"return false\" galleryimg=\"no\" usemap=\"#imagemap\" alt=\"\"/>";
			   var html="<a href=\"javascript:initializeAlbum('" +  albumName +"')\">" +  img_html + "</a>";
			   column.innerHTML = html;

			   row = table.insertRow(lastRow++);
			   column = row.insertCell(0)
			   column.innerHTML = albumName;

			   row = table.insertRow(lastRow++);
			   column = row.insertCell(0)
			   column.innerHTML = "<img src=\"space.gif\" class=\"slideImage\" width=\"10\" height=\"10\" ondragstart=\"return false\" onselectstart=\"return false\" oncontextmenu=\"return false\" galleryimg=\"no\" usemap=\"#imagemap\" alt=\"\">";
		   }

	}

	function displayGallery() {
		setVisibility('gallery',true);
		setVisibility('album',false);
	}

	function initializeAlbum(albumName) {
		try {
			this.albumName = albumName; 
			gallery.getAlbumPictures(albumName).addCallback(gallery_getAlbumPicturesResponse)
		} catch(exception) {
			alert(e);
		}		
	}

	function gallery_getAlbumPicturesResponse(items, exception) {
		if(exception) {
			alert(exception.msg);
			displayGallery();
			return;
		}
		albumItems = items;
		albumPos = 0;
		showAlbum();
	}

	function showAlbum() {
		if(albumItems.length > 0) {
			showImage(albumPos);
		}
		displayAlbum();
	}	
	
	function displayAlbum() {
		setVisibility('gallery',false);
		setVisibility('album',true);
	}

	function showImage(albumPos) {		
	   	var img = document.createElement("img");
		img.onload = function(evt) {
			document.getElementById("albumImage").src = this.src;
	        document.getElementById("albumImage").width=this.width;
	        document.getElementById("albumImage").height=this.height;
	    }
	    var vvv = albumItems[albumPos];
	    img.src = "gallery/" + albumName + "/" + albumItems[albumPos];
	    return false;
	}

	function goNext() {
		if(albumPos < albumItems.length) {
			albumPos++;
			showImage(albumPos);
		}
	}

	function goPrevious() {
		if(albumPos > 0) {
			albumPos--;
			showImage(albumPos);
		}
	}
	
	function setVisibility(divId, visible) {
		//valid values { visible, hidden }
		if (document.getElementById) {
			var element = document.getElementById(divId)
			if(visible) {
				element.style.display = 'block';
				element.style.visibility = 'visible';
			} else {
				element.style.display = 'none';
				element.style.visibility = 'hidden';
			}
		}
	} 

</script>

</head>

<body onload="initGallery()">
<br>
<h1><center>Apache PhotArk Gallery</center></h1>
<br>
<br>

<div id='gallery' style='display:none;visibility:hidden;'>
     <center>
     <table id='tableGallery' style='width:720px;' border='0' cellspacing='0' cellpadding='1'></table>
     </center>
</div>
  
<div id="album" style="display:none;visibility:hidden;">
  <center>

  <table style="height:54px;" cellspacing="0" cellpadding="0" border="0">
     <tr>
     	<td valign="middle">
     	   <!-- Navigation Header -->
		   <table style="width:100%;" cellspacing="0" cellpadding="0" border="0">
             <tr>
             	<td style="width:31px;"><a href="javascript:displayGallery()" onmouseover="document.index.src=index_on.src" onmouseout="document.index.src=index_off.src"><img src="index.gif" width="31" height="31" border="0" title="Index page" name="index" alt=""></a></td>
                <td style="width:31px;"><a href="javascript:goPrevious()" onmouseover="document.previous.src=prev_on.src" onmouseout="document.previous.src=prev_off.src"><img src="prev.gif" width="31" height="31" border="0" title="Previous image" name="previous" alt=""></a></td>
                <td style="width:31px;"><a href="javascript:goNext()" onmouseover="document.next.src=next_on.src" onmouseout="document.next.src=next_off.src"><img src="next.gif" width="31" height="31" border="0" title="Next image" name="next" alt=""></a></td>
                <!-- <td style="width:31px;"><a href="javascript:void(0)" onmouseover="show_over();" onmouseout="show_out();" onmousedown="show_down();" ondblclick="change_delay();"><img src="show_slide.gif" width="31" height="31" border="0" title="Start/Stop slideshow - DoubleClick to change speed" name="show" alt=""></a></td> -->
             </tr>
		   </table>
		</td>
	</tr>
  </table>

  <table style="width:720px;" border="0" cellspacing="0" cellpadding="0">
    <tr>
     	<td align="center"> <!-- Image without original -->
        <img id="albumImage" src="space.gif" class="slideImage" width="720" height="540" ondragstart="return false" onselectstart="return false" oncontextmenu="return false" galleryimg="no" usemap="#imagemap" alt="">
		</td>
    </tr>
  </table>

  </center>  
</div>

</body>
</html>